# Линейные модели в машинном обучении
# Описание проекта
Мы работаем в IT-компании, которая выполняет на заказ проекты по машинному обучению. К нам обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».
Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. А продавцы и технологи так и норовят приукрасить своих коровок!
Поэтому он просит нас разработать модель машинного обучения, которая поможет ему управлять рисками и принимать объективное решение о покупке. «ЭкоФерма» готова предоставить подробные данные о своих коровах.

# Цели
Отобрать коров для фермера по двум критериям:
- средний удой за год не меньше 6000 кг;
- молоко должно быть вкусным.

# Задачи
1) Исследовать данные и обнаружить есть ли проблемы с ними;
2) Определить какие есть взаимосвязи между признаками в данных;
3) Построить несколько моделей и решить какая лучше предсказывает удой и вкус молока.

# План работы
1) Загрузка и изучение данных;
2) Предобработка данных;
3) Исследовательский анализ;
4) Проведем корреляционный анализ признаков в датасете `ferma_main.csv`;
5) Посторим модели линейной регрессии;
6) Посторим модели логистической регрессии;
7) Подведём итоги.

# Описание данных
Файл `ferma_main.csv` содержит данные о стаде фермера на текущий момент.

Признаки в датасете `ferma_main.csv` можно разделить на группы:
- Характеристики коровы: `id`, `Порода`, `порода папы_быка`, `Возраст`.
- Характеристика корма: `ЭКЕ (Энергитическая кормовая единица`), `Сырой протеин, г`, `СПО(Сахаро-протеиновое соотношение)`.
- Характеристика пастбища: `Тип пастбища`.
- Характеристика молока: `Удой, кг`, `Жирность, %`, `Белок, %`, `Вкус молока`.

Файл `ferma_dad.csv` хранит имя папы каждой коровы в стаде фермера.
- `id`
- `Имя папы`

Файл `cow_buy.csv` содержит данные о коровах "ЭкоФермы" которых хочет изучить перед покупкой фермер.
- `Порода`
- `Тип пастбища`
- `порода папы_быка`
- `Имя_папы`
- `Текущая_жирность,%`
- `Текущий_уровень_белок,%`
- `Возраст`

У датасета `cow_buy.csv` есть несколько особенностей:
- Содержание белков и жиров в молоке указано на момент продажи — когда «ЭкоФерма» давала коровам свой корм.
- Параметры корма `ЭКЕ (Энергетическая кормовая единица)`, `Сырой протеин, г` и `СПО (Сахаро-протеиновое соотношение)` отсутствуют. Технологи заказчика пересмотрели подход к кормлению: для новых коров планируется увеличить значения каждого из этих параметров на 5%.
- Кроме того, отсутствуют признаки `Удой, кг` и `Вкус молока`. Это целевые признаки, именно их предстоит предсказать.

# Вывод
1) Выполнили предобработку данных:
    - пропусков не обнаружено;
    - удалили 5 явных дубликтов и 2 неявных в `ferma_main`;
    - Изменили единицы измерения: граммы в кг., процента в доли ед.
    - Типы данных в порядке


2) Провели исследовательский анализ:

    - построили графики и диграммы размаха для всех данных;
    - удалили выброс(45616 кг) в столбце `удой`;
    - 5250 - 7250 кг. - диапазон `удоя` у коров фермера;
    - 75% коров имеют удой больше 5750 кг.;
    - Выделяются три 3 группы `спо`: 0.84 - 0.86, 0.88 - 0.90, 0.93 - 0.96.
    - 75% молока имеет жирность больше 3.6%.
    - 75% молока имеет белок больше 3.074%.
    - 83% коров имеют возраст больше 2 лет;
    - 72.4% короров имеют имена пап Буйный или Барин;
    - Коровы у "ЭкоФермы" практически имеют похожие категориальные и количественные признаки.

3) Провели корреляционный анализ признаков в датасете `ferma_main.csv`:
 
    - сильная положительная линейная связь целевого признака `удой` c `эке`;
    - умеренная прямая связь целевого признака удой с сырой_протеин, но линейности не наблюдается;
    - при взаимосвязи целевого признака `удой` с `спо` выделяется две группы: меньше 0.91 и больше 0.91.
    - нелинейная связь с жирностью, но при жирности больше 3.6% наблюдается повышенный удой.
    - у породы РефлешнСоверинг молоко имеет больше жирность.
    - `белок` не влияет на `удой`.
    - у породы Вис Бик Айдиал чаще попадается повышенное содержание белка.
    - Мультиколлиниарность не наблюдается.
  
4) Построили несколько моделей линейной регрессии. Выбрали 3 модель как самую лучшую. Её краткое описание:
    - Добавили новые входные признаки: `спо_категория`,	`эке_2`, `имя_папы`.
    - Распределение получилось практически симметричным с небольшим смещением влево.
    - Местами разброс остаков непостоянен, но это лучше остальных моделей.
    - По метрике R2 в 82% случаев предсказание модели ближе к истине, чем среднее значение целевого признака.
    - По метрике MAE в среднем модель отклоняется от истинного значения целевого признака на 146 кг удой.
    - По метрике RSME в среднем модель ошибается примерно на 189 кг удоя.
    - Модель с 95% вероятностью будет попадать в интервал 5356 - 6968 кг.

В результате был сделан прогноз `удой` на данных из "Экофермы", с учётом того что в `cow_buy` были добалены средние характеристики корма(`спо`,	`эке`, `сырой_протеин`) из `ferma_main` увеличенные на 5%. `Удой` у коров из "Экофермы" получился у всех выше 6000 кг..

Так как на момент покупки характеристики корма и молока у "Экофермы" оствались ещё старыми, то фермеру лучше подождать когда компания даст информацию о фактических характеристиках корма и молока после увелечение `спо`,	`эке`, `сырой_протеин`.

5) Построили модель логистической регрессии. Выбрали порог 0.79, получили метрики:
    - acc = 0.54
    - precision = 1.0
    - recall = 0.17

С помощью данного порога(0.79), мы исключили варианты, когда модель предсказывает вкусное молоко, но  оно фактически оказывается не вкусное. 

В случае если модель предсказывает, что молоко не вскусное и ошибается,так как оно является фактически вкусным. Данный случай будет на пользу фермеру.
 
При использовании данной модели с порогом 0.79 получилось предсказать 7 коров "ЭкоФерма" с вкусным молоком и удоем больше 6000 кг..

В результате при выборе коров "ЭкоФерма" фермеру нужно учитывать, что характеристики корма(`спо`, `эке`, `сырой_протеин`) будут такими же как мы выбрали в обученной модели, в случае если они будут другими лучше ещё раз переобучить модель. 

Исходя из полученной модели у всех одинаковые характеристики корма, поэтому нужно опираться на вспомогательные признаки. Для фермера лучше выбирать коров породы Вис Бик Айдиал с холмистого пастбища, так как там больше попадается вкусное молоко и удой больше 6000 кг..
